# BLANK25 作問モード 要件定義（2026-02-27）

## 1. 目的

BLANK25に「作問モード」を追加し、2人1組で以下の遊び方を可能にする。

- 作問者: 画像が全面表示された状態から、隠したいマスを選択する
- 作問者: `ロック` ボタンで盤面を確定する
- 回答者: ロック後の盤面を見ながら回答を入力し、正誤判定を行う

## 2. 適用範囲

- 対象: `src/components/blank25/blank25-game.tsx` を中心とした BLANK25 プレイ画面
- 対象外: リアルタイム通信による別端末同期、ユーザー認証、ランキング機能

## 3. 用語定義

- 作問者: 隠すパネル配置を決めるプレイヤー
- 回答者: ロック後の盤面で回答を行うプレイヤー
- 作問モード: 作問者が隠すマスを設計できるモード
- ロック: 隠し配置を確定し、編集不可にする操作

## 4. ユーザーストーリー

1. ペアで遊ぶユーザーとして、作問者が任意のマスを隠せるようにしたい。
2. 作問者として、配置を確定後に誤操作で変更されないようロックしたい。
3. 回答者として、ロック済み盤面を見ながら答えを考えたい。
4. 途中でやり直すユーザーとして、盤面を初期化して再作問したい。

## 5. 画面・操作要件

## 5.1 モード選択

- BLANK25プレイ画面に `通常モード` / `作問モード` の切替導線を追加する。
- 初期値は `通常モード` とする。
- `作問モード` はURLクエリ（例: `?mode=sakumon`）でも直接遷移可能にする。

## 5.2 作問フェーズ（ロック前）

- 初期盤面は「25マスすべて画像表示（パネルなし）」とする。
- マス押下で `隠す` / `隠さない` をトグルできる。
- 隠したマスは黒パネル（既存デザイン準拠）で表示する。
- 以下を表示する。
  - `隠し枚数`
  - `表示枚数`
  - `ロック` ボタン
  - `作問やり直し` ボタン

## 5.3 ロック操作

- `ロック` 押下時に確認ダイアログを表示する。
- 確定後は以下を満たす。
  - 盤面編集不可（マス押下しても状態変化しない）
  - `ロック済み` 状態を明示表示する
  - 回答入力と判定ボタンを有効化する
- ロック後に配置を変更したい場合は `作問やり直し` で初期状態に戻す（ロック解除のみは不可）。

## 5.4 回答フェーズ（ロック後）

- 回答者はロック済み盤面を見ながら回答を入力できる。
- 判定ロジックは既存BLANK25の回答正規化・正誤判定を再利用する。
- 正解時は既存クリア演出（ダイアログ/紙吹雪）を利用する。
- 不正解時は再入力可能。

## 6. 状態遷移要件

作問モードは以下の状態を持つ。

- `draft`: 作問中（編集可能）
- `locked`: ロック済み（編集不可、回答可能）
- `solved`: 正解済み

遷移:

1. 画面開始時: `draft`
2. `ロック` 確定: `draft -> locked`
3. 正解判定: `locked -> solved`
4. `作問やり直し`: `draft/locked/solved -> draft`

## 7. データ保持要件（localStorage）

- 既存キーとは分離し、作問モード専用キーを使用する。
  - 例: `blank25:sakumon:v1:<manifestVersion>:<problemId>`
- 保存対象:
  - `phase`（`draft|locked|solved`）
  - `hiddenPanels`（25件boolean）
  - `lockedAt`（number|null）
  - `startedAt` / `solvedAt`
  - `isCorrect` / `score`
- リロード時は状態を復元する。

## 8. バリデーション・制約

- `hiddenPanels` は常に25件であること。
- ロック前のみ盤面編集を許可する。
- 判定処理は `locked` 以降のみ許可する。
- データ破損時は安全側で初期状態（`draft`）にフォールバックする。

## 9. 非機能要件

- 既存BLANK25のレスポンシブ表示を維持する。
- キーボード操作（Enter判定）を維持する。
- 色覚に配慮し、`ロック済み` は文言でも状態識別可能にする。

## 10. 受け入れ条件（Acceptance Criteria）

1. 作問モード開始時、25マスすべてが表示状態で開始する。
2. 作問フェーズで任意マスを隠す/戻す操作ができる。
3. `ロック` 後は盤面が編集できない。
4. `ロック` 後に回答入力と判定が機能する。
5. 正解時に既存のクリア導線が動作する。
6. `作問やり直し` で初期状態に戻り再作問できる。
7. リロード後も `phase` と盤面状態が復元される。

## 11. 未確定事項（実装前確認）

- 作問者と回答者の画面切替手順（同一端末で手渡し前提か）
- ロック前に最低1マス以上を隠す必須ルールにするか
- 作問モードのスコア定義（`隠し枚数`、`表示枚数`、またはスコアなし）
- 問題一覧画面に「作問モードで開始」ボタンを追加するか
