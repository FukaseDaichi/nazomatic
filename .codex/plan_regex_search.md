# 正規表現検索タブ追加 実装方針（案）

## 目的
既存のアナグラム / クロスワード検索画面に「正規表現検索」タブ（tab3）を追加し、辞書内の単語を任意の正規表現で検索できるようにする。

## 画面改修方針
- `tabs` 配列に `tab3` を追加し、タイトル・説明・ツールチップ（正規表現の例や注意点）を定義する。
- タブ切り替えハンドリングは既存ロジックを踏襲し、`activeTab === "tab3"` の場合に正規表現専用の説明や入力プレースホルダを表示する。
- 入力 UI は既存の `Input` を共用するが、正規表現タブでは以下の点を切り替える:
  - プレースホルダを `例: ^し.*ん$` 等に差し替える。
  - 補足説明に「JavaScript 正規表現」「大文字小文字の扱い」「辞書正規化の影響」などのガイドを追記。
  - 濁点ボタンなどクロスワード専用 UI は非表示。
- 検索ボタンや結果表示 UI は共通コンポーネントを利用し、結果文言に検索パターンを含む注意書きを追加する。

## 状態・ロジック改修方針
- 入力値は既存の `searchWord` ステートを活用。タブ別に処理を分岐するため、`handleSearch` 内に正規表現分岐を追加。
- 正規表現タブ選択時は `SearchManager.findRegexAsync(pattern, dictionaryKey)`（後述）を呼び出す。
- 無効な正規表現（`new RegExp` 生成で例外）を検知し、`setErrorMessage` / `setResults([])` 等でユーザーにエラートーストまたはメッセージを出す処理を追加する。
- 上限件数 (`ANAGRAM_RESULT_MAXCOUNT`) は共通で適用する。

## SearchManager 拡張方針
- 既存の `SearchManager` に以下を追加する。
  1. `findRegexAsync(pattern: string): Promise<string[]>`
     - 既にキャッシュ済みの `dictionary.words`（正規化後）を対象に `RegExp` マッチング。
     - 大文字小文字の扱い: 英語辞書は小文字化済み、和文辞書は `normalizeWord` によりひらがな化済みのため、そのまま比較でOK。必要に応じて入力パターンも `normalizeWord` / 全角→半角変換を適用する。
     - 失敗時は例外を投げ、呼び出し側で UI 表示。
     - マッチ総数が `ANAGRAM_RESULT_MAXCOUNT` に達した時点で打ち切り。
  2. 補助関数 `normalizeRegexInput(pattern: string)`（任意）を用意し、クロスワードと同様の全角数字→半角、ひらがな化などを適用して辞書側と揃える。
- 既存の `wordsByLength` 等の構造体を流用。正規表現では長さ別に分けず、`dictionary.words` をそのままループする。

## エラーハンドリング / バリデーション
- 空文字は検索不可としてエラーメッセージを表示。
- `SearchManager.findRegexAsync` 内で `new RegExp(pattern)` を try-catch し、エラー内容を呼び出し側に返却。
- 極端に複雑な正規表現でパフォーマンスが低下する恐れがあるため、UI で「長時間かかる可能性」を注意書きで伝える。

## 表示メッセージ
- 成功: 既存の結果リスト形式を流用。
- 0件: 「正規表現に一致する結果はありません」等に変更。
- エラー: カード内に赤字メッセージを表示するか、既存の `setErrorMessage`（未実装なら新規）で状態を持つ。

## 今後のテスト方針 (実装後)
- 豚辞書と CEFR 辞書でそれぞれ複数パターン（先頭一致、末尾一致、任意文字、濁点含み）を手動検証。
- 無効なパターン（`[未閉じ` など）でエラーメッセージが表示されることを確認。
- タブ切り替えで入力値／結果が期待通り維持またはリセットされることを確認。

## 作業ブレークダウン (参考)
1. `tabs` 定義・UI の文言調整。
2. `handleSearch`・辞書切り替えロジックの分岐整理。
3. `SearchManager` に正規表現検索 API を追加。
4. バリデーション／エラー UI の整備。
5. 手動動作確認・仕様書への追記。
