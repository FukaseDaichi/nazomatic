name: Realtime Register Accompany

on:
  workflow_dispatch:
  schedule:
    - cron: "30 * * * *" # Every hour at minute 30

jobs:
  trigger-register:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      - name: Invoke realtime register API
        env:
          BASE_URL: ${{ secrets.REALTIME_API_BASE_URL }}
          API_TOKEN: ${{ secrets.REALTIME_API_TOKEN }}
        run: |
          if [ -z "$BASE_URL" ] || [ -z "$API_TOKEN" ]; then
            echo "Missing required secrets REALTIME_API_BASE_URL or REALTIME_API_TOKEN."
            exit 1
          fi

          curl --fail --silent --show-error \
            --retry 3 --retry-delay 5 \
            -X POST "$BASE_URL/api/internal/realtime/register" \
            -H "Authorization: Bearer $API_TOKEN" \
            -H "Content-Type: application/json" \
            -d '{"query":"#謎解き同行者募集","limit":20,"dryRun":false}'
